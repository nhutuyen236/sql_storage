SELECT 
	date(so.date_order + interval '7 hour'),
    so.name as so, 
    sp.name as phieu_out, 
    pp.barcode, 
    pt.name as product, 
    SUM(sol.product_uom_qty) AS product_uom_qty,
    SUM(sol.qty_delivered) AS qty_delivered,
    SUM(sol.price_subtotal) as daily_sale, 
	sp.state,
    temp.name as RETURN,
	scr.name as cancel_reason
from sale_order_line sol
left join product_product pp on pp.id = sol.product_id
left join product_template pt on pt.id = pp.product_tmpl_id 
left join sale_order so on sol.order_id = so.id 
left join stock_picking sp on sp.sale_id = so.id and sp.product_id = sol.product_id
left join (SELECT name,
SUBSTRING(origin FROM POSITION('AMLSG' IN origin)) as source_doc
from stock_picking
WHERE NAME LIKE '%RT%') temp ON temp.source_doc = sp.name
left join shipment_cancellation_reason scr on sp.cancel_reason_id = scr.id
where extract (month from date(so.date_order + interval '7 hour')) = 9 
and pp.barcode is not null and 
sol.product_uom_qty <> sol.qty_delivered
and so.name in ('VN-3531209',
'VN-3618529',
'VN-3757825',
'VN-3862836',
'VN-3941117',
'VN-4146524',
'VN-4160558',
'VN-4162934',
'VN-4163347',
'VN-4165832',
'VN-4189405',
'VN-4198812',
'VN-4216357',
'VN-4220014',
'VN-4220330',
'VN-4220611',
'VN-4223954',
'VN-4224427',
'VN-4224720',
'VN-4228933',
'VN-4229629',
'VN-4230425',
'VN-4231255',
'VN-4231321',
'VN-4232511',
'VN-4233319',
'VN-4236658',
'VN-4243832',
'VN-4244227',
'VN-4246300',
'VN-4247410',
'VN-4249255',
'VN-4251145',
'VN-4251551',
'VN-4252019',
'VN-4252440',
'VN-4252955',
'VN-4256616',
'VN-4256758',
'VN-4258508',
'VN-4260424',
'VN-4261713',
'VN-4263706',
'VN-4265553',
'VN-4265703',
'VN-4267331',
'VN-4269112',
'VN-4271255',
'VN-4279653',
'VN-4280311',
'VN-4283627',
'VN-4286051',
'VN-4286214',
'VN-4287240',
'VN-4288507',
'VN-4293713',
'VN-4297228',
'VN-4299400',
'VN-4301132',
'VN-4301319',
'VN-4301549',
'VN-4302213',
'VN-4302857',
'VN-4304217',
'VN-4304439',
'VN-4305326',
'VN-4305856',
'VN-4307524',
'VN-4309954',
'VN-4310136',
'VN-4314100',
'VN-4315708',
'VN-4316238',
'VN-4316326',
'VN-4320732',
'VN-4321955',
'VN-4326504',
'VN-4327432',
'VN-4329637',
'VN-4330944',
'VN-4331604',
'VN-4332423',
'VN-4333201',
'VN-4333410',
'VN-4335940',
'VN-4336710',
'VN-4337034',
'VN-4337157',
'VN-4340658',
'VN-4343633',
'VN-4345507',
'VN-4347916',
'VN-4353205',
'VN-4354942',
'VN-4357306',
'VN-4358026',
'VN-4359116',
'VN-4359312',
'VN-4361738',
'VN-4363039',
'VN-4364315',
'VN-4365825',
'VN-4368113',
'VN-4369845',
'VN-4373601',
'VN-4374358',
'VN-4374931',
'VN-4385125',
'VN-4385504',
'VN-4391235',
'VN-4391618',
'VN-4400158',
'VN-4401944',
'VN-4402632',
'VN-4406335',
'VN-4406923',
'VN-4407252',
'VN-4410218',
'VN-4412759',
'VN-4416430',
'VN-4419029',
'VN-4419131',
'VN-4424832',
'VN-4425548',
'VN-4425909',
'VN-4428842',
'VN-4432152',
'VN-4432342',
'VN-4432810',
'VN-4435528',
'VN-4437438',
'VN-4438752',
'VN-4440718',
'VN-4441222',
'VN-4446851',
'VN-4449938',
'VN-4452739',
'VN-4454706',
'VN-4456447',
'VN-4458547',
'VN-4458855',
'VN-4459200',
'VN-4460006',
'VN-4461147',
'VN-4462851',
'VN-4463045',
'VN-4463100',
'VN-4463209',
'VN-4470610',
'VN-4472123',
'VN-4472330',
'VN-4477230',
'VN-4479405',
'VN-4480228',
'VN-4486223',
'VN-4489141',
'VN-4495519',
'VN-4498449',
'VN-4498645',
'VN-4499225',
'VN-4500455',
'VN-4502846',
'VN-4503024',
'VN-4503317',
'VN-4503513',
'VN-4505015',
'VN-4506524',
'VN-4507510',
'VN-4510954',
'VN-4511556',
'VN-4511920',
'VN-4512758',
'VN-4513252',
'VN-4515015',
'VN-4518310',
'VN-4523515',
'VN-4524013',
'VN-4526202',
'VN-4534931',
'VN-4535001',
'VN-4538029',
'VN-4541441',
'VN-4546037',
'VN-4547118',
'VN-4548832',
'VN-4550430',
'VN-4553117',
'VN-4553732',
'VN-4555525',
'VN-4557102',
'VN-4558546',
'VN-4559452',
'VN-4567810',
'VN-4568748',
'VN-4571854',
'VN-4571909',
'VN-4572551',
'VN-4572641',
'VN-4574745',
'VN-4575908',
'VN-4580251',
'VN-4580302',
'VN-4581626',
'VN-4584029',
'VN-4584627',
'VN-4585900',
'VN-4586549',
'VN-4589834',
'VN-4592540',
'VN-4592731',
'VN-4594847',
'VN-4606901',
'VN-4609446',
'VN-4612044',
'VN-4615231',
'VN-4616318',
'VN-4625518',
'VN-4626329',
'VN-4628748',
'VN-4633200',
'VN-4639737',
'VN-4642403',
'VN-4642813',
'VN-4644339',
'VN-4644426',
'VN-4648522')
group by 1,2,3,4,5,9,10,11
order by 1
